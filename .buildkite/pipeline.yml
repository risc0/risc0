steps:
  - label: "check"
    agents:
      queue: hosted-linux-small
    plugins:
      - .buildkite/plugins/rustup:
    command: .buildkite/scripts/check.sh

  - label: ":rust: Clippy {{matrix.os}}/{{matrix.arch}}/{{matrix.feature}}"
    agents:
      arch: "{{matrix.arch}}"
      os: "{{matrix.os}}"
    matrix:
      setup:
        arch: x64
        os: linux
        feature: default
      adjustments:
        - with:
            arch: "x64"
            os: "linux"
            feature: "cuda"
    env:
      FEATURE: "{{matrix.feature}}"
      RISC0_SKIP_BUILD: 1
      RISC0_SKIP_BUILD_KERNELS: 1
    plugins:
      - .buildkite/plugins/cuda:
      - .buildkite/plugins/rustup:
      - .buildkite/plugins/sccache:
      - .buildkite/plugins/protoc:
    if_changed:
      - .buildkite/**
      - rzup/**
      - risc0/**
      - Cargo.toml
      - Cargo.lock
      - rust-toolchain.toml
    command: .buildkite/scripts/clippy.sh
